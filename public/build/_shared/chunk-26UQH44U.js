import{a as h}from"/build/_shared/chunk-DLUBBNLS.js";import{a as S,b as C,c as D,d as T,e as w,f as I,g as F,h as k}from"/build/_shared/chunk-HYPIXEO2.js";import{a as _}from"/build/_shared/chunk-IWGJOQMS.js";import{a as i}from"/build/_shared/chunk-DU3ERRUZ.js";import{a as P}from"/build/_shared/chunk-EQOSR4CK.js";import{a as O,b as v}from"/build/_shared/chunk-DFX53F3J.js";import{b as E}from"/build/_shared/chunk-EHYIQE7U.js";import{a as L}from"/build/_shared/chunk-PAN7QPZK.js";import{a as K}from"/build/_shared/chunk-IXKRAC64.js";import{a as p,b as x}from"/build/_shared/chunk-7ERNTC7H.js";import{a as A}from"/build/_shared/chunk-G6RWU2BR.js";import{l as H,m as j,t as y}from"/build/_shared/chunk-SN2BHVXC.js";import{a as U,b as c}from"/build/_shared/chunk-653BTUZP.js";import{c as m}from"/build/_shared/chunk-W5DRAD4K.js";var s=m(c(),1);function W({contest:e,disabled:a}){let r=y();return(0,s.jsxs)(S,{children:[(0,s.jsx)(C,{disabled:a,title:"Delete contest",className:P("flex items-center justify-center border min-w-[32px] min-h-[32px] rounded-full border-red-500 bg-red-50 text-red-500",{"bg-slate-100 border-slate-400 text-slate-400 cursor-not-allowed":a}),children:(0,s.jsx)(x,{src:p.trashIcon,className:"w-3"})}),(0,s.jsxs)(T,{className:"bg-secondary p-0 gap-0",children:[(0,s.jsxs)(w,{children:[(0,s.jsxs)(F,{className:"p-4 flex gap-3",children:[(0,s.jsx)("div",{className:"size-11 rounded-full bg-orange-100 flex items-center justify-center",children:(0,s.jsx)(x,{src:p.questionIcon})}),(0,s.jsxs)("p",{children:[(0,s.jsx)("span",{className:"block",children:"Delete contest"}),(0,s.jsx)("span",{className:"font-normal text-base text-admin-pry",children:"Confirm the deletion of this contest"})]})]}),(0,s.jsxs)(k,{className:"border-y p-4",children:[(0,s.jsxs)("span",{className:"text-primary mb-2 block",children:["Are you sure you want to delete ",e.name," contest?"]}),(0,s.jsx)("span",{className:"text-admin-pry",children:"This action is irreversible and will permanently delete this contest."})]})]}),(0,s.jsx)(I,{className:"flex justify-end gap-6 p-4",children:(0,s.jsxs)(r.Form,{method:"post",children:[(0,s.jsx)("input",{type:"hidden",name:"contestId",value:e._id}),(0,s.jsx)(D,{type:"submit",name:"intent",value:"delete",className:"bg-red-500 px-10 py-2 rounded-md font-bold min-w-[90px] text-white",children:"Proceed"})]})})]})]})}var l=m(c(),1);function G({contest:e,disabled:a}){let r=y(),o=e.stages.toSorted((g,N)=>g.stage-N.stage).reduce((g,N,J,Q)=>(N.active&&!g[0]&&(g[0]=N,g[1]=Q.at(J+1)??null),g),[null,null]),d=e.stages.findIndex(g=>g.active),f=d!==-1&&d<e.stages.length-1,R=a||!o.at(0)||!o.at(1)||!f;return(0,l.jsxs)(S,{children:[(0,l.jsx)(C,{asChild:!0,children:(0,l.jsx)(h,{disabled:R,icon:p.doubleArrowRightIcon,className:"border-indigo-700 bg-indigo-100 text-indigo-700",title:"Migrate stage"})}),(0,l.jsxs)(T,{className:"bg-secondary p-0 gap-0",children:[(0,l.jsxs)(w,{children:[(0,l.jsxs)(F,{className:"p-4 flex gap-3",children:[(0,l.jsx)("div",{className:"size-11 rounded-full bg-orange-100 flex items-center justify-center",children:(0,l.jsx)(x,{src:p.questionIcon})}),(0,l.jsxs)("p",{children:[(0,l.jsx)("span",{className:"block",children:"Migrate stage"}),(0,l.jsx)("span",{className:"font-normal text-base text-admin-pry",children:"Confirm migration to the next stage"})]})]}),(0,l.jsx)(k,{className:"border-y p-4",children:(0,l.jsxs)("span",{className:"text-primary block",children:["This will migrate all safe contestants from stage ",o[0]?.stage," to stage ",o[1]?.stage,". Proceed?"]})})]}),(0,l.jsx)(I,{className:"flex justify-end gap-6 p-4",children:(0,l.jsxs)(r.Form,{method:"post",children:[(0,l.jsx)("input",{type:"hidden",name:"from",value:o[0]?._id}),(0,l.jsx)("input",{type:"hidden",name:"to",value:o[1]?._id}),(0,l.jsx)(D,{type:"submit",name:"intent",value:"migrate",className:"bg-accent px-10 py-2 rounded-md font-bold min-w-[90px] text-white",children:"Proceed"})]})})]})]})}var u=m(c(),1);function M({rowData:e}){let a=e.stages.find(d=>d.active||d.status==="ongoing")?._id??e.stages.toSorted((d,f)=>f.stage-d.stage).find(d=>d.status==="completed")?._id??e.stages.toSorted((d,f)=>d.stage-f.stage).at(0)?._id,r=a?`/admin/contests/${e.id}/${a}`:"",o=y();return(0,u.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,u.jsx)(h,{icon:p.contestantsIcon,element:"link",to:r,"aria-disabled":!r,className:"border-green-500 bg-green-50 text-green-500",title:"View current stage"}),(0,u.jsx)(h,{icon:p.editIcon,element:"link",to:`/admin/contests/${e.id}`,className:"border-[#262626] bg-[#F7F7F8] text-primary",title:"Edit contest"}),(0,u.jsxs)(o.Form,{method:"post",children:[(0,u.jsx)("input",{type:"hidden",name:"contestId",value:e._id}),(0,u.jsx)(h,{icon:p.viewIcon,name:"intent",value:"toggle_registration",className:"border-yellow-700 bg-yellow-100 text-yellow-700","aria-disabled":o.state!="idle",title:"Open/Close registration"})]}),(0,u.jsx)(G,{contest:e}),(0,u.jsx)(W,{contest:e})]})}var V=m(U(),1);var z=m(A(),1);var q=m(A(),1);var b=m(c(),1);function $({grade:e}){let[a,[r,o]]=e;return(0,b.jsxs)("div",{className:"flex gap-2",children:[(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("span",{className:"block font-bold",children:"Grade"}),(0,b.jsx)("span",{className:(0,q.default)(`h-full w-[40px] px-2 py-1 flex items-center justify-center bg-grade-${a} rounded-md text-white font-black`),children:a})]}),(0,b.jsx)(i,{as:"input",id:`min_${a}`,name:`min_${a}`,labelText:"Min. Score",type:"number",min:0,defaultValue:r}),(0,b.jsx)(i,{as:"input",id:`max_${a}`,name:`max_${a}`,labelText:"Max. Score",type:"number",min:0,defaultValue:o})]})}var t=m(c(),1);function B({row:e}){let[a,r]=(0,V.useState)(e.original.stages[0]??null);return(0,t.jsxs)("div",{className:"p-6",children:[(0,t.jsx)("div",{className:"p-3 flex gap-2 border border-disabled bg-[#F6F8FA] rounded-md",children:e.original.stages.length?e.original.stages.map(o=>(0,t.jsxs)(_,{element:"button",variant:"outline",onClick:()=>r(o),className:(0,z.default)("px-5 py-1 text-xs text-admin-pry rounded-md",{"border-secondary bg-white":a?.stage===o.stage,"border-transparent":a?.stage!==o.stage}),children:["Stage ",o.stage]},o._id)):(0,t.jsx)("span",{children:"There are no stages."})}),a?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(X,{stage:a,contestId:e.original.id,closeForm:e.getToggleExpandedHandler()},a._id),(0,t.jsx)("hr",{}),(0,t.jsx)(Y,{stage:a})]}):null]})}function X({stage:e,contestId:a,closeForm:r}){return(0,t.jsxs)(j,{method:"POST",className:"text-primary text-xs flex flex-col gap-4",children:[(0,t.jsxs)("fieldset",{className:"py-4 grid grid-cols-4 gap-3 border-b",children:[(0,t.jsx)(i,{as:"input",id:"start_date",name:"start_date",labelText:"Stage Start Date",type:"datetime-local",defaultValue:E(e.start_date)}),(0,t.jsx)(i,{as:"input",id:"end_date",name:"end_date",labelText:"Stage End Date",type:"datetime-local",defaultValue:E(e.end_date)}),(0,t.jsx)(i,{as:"input",id:"weight",name:"weight",labelText:"Stage Weight (%)",type:"number",min:0,defaultValue:e.weight}),(0,t.jsx)(i,{as:"input",id:"success_count",name:"success_count",labelText:"Success Count",type:"number",min:0,defaultValue:e.success_count})]}),(0,t.jsxs)("fieldset",{className:"pt-2 pb-4 grid grid-cols-4 gap-3 border-b",children:[(0,t.jsxs)("legend",{className:"font-bold text-sm text-admin-pry w-max",children:["Stage Rates ",(0,t.jsx)("span",{className:"font-normal",children:"(must sum up to 100%)"})]}),(0,t.jsx)(i,{as:"input",id:"social_media_rate",name:"social_media_rate",labelText:"Social Media Rate (%)",type:"number",min:0,defaultValue:e.rates.social_media.amount}),(0,t.jsx)(i,{as:"input",id:"tally_rate",name:"tally_rate",labelText:"Tally Rate (%)",type:"number",min:0,defaultValue:e.rates.tally}),(0,t.jsx)(i,{as:"input",id:"givaah_rate",name:"givaah_rate",labelText:"Givaah Rate (%)",type:"number",min:0,defaultValue:e.rates.givaah}),(0,t.jsx)(i,{as:"input",id:"judge_rate",name:"judge_rate",labelText:"Judge Rate (%)",type:"number",min:0,defaultValue:e.rates.judge}),(0,t.jsx)(i,{as:"input",id:"social_media_bonus_rate",name:"social_media_bonus_rate",labelText:"Social Media Bonus Rate (%)",type:"number",min:0,defaultValue:e.rates.social_media_bonus}),(0,t.jsx)(i,{as:"input",id:"tally_bonus_rate",name:"tally_bonus_rate",labelText:"Tally Bonus Rate (%)",type:"number",min:0,defaultValue:e.rates.tally_bonus}),(0,t.jsx)(i,{as:"input",id:"givaah_bonus_rate",name:"givaah_bonus_rate",labelText:"Givaah Bonus Rate (%)",type:"number",min:0,defaultValue:e.rates.givaah_bonus}),(0,t.jsx)(i,{as:"input",id:"judge_bonus_rate",name:"judge_bonus_rate",labelText:"Judge Bonus Rate (%)",type:"number",min:0,defaultValue:e.rates.judge_bonus})]}),(0,t.jsxs)("fieldset",{className:"pt-2 py-4 grid grid-cols-2 gap-3 border-b",children:[(0,t.jsx)("legend",{className:"font-bold text-sm text-admin-pry",children:"Grades"}),Object.entries(e.grade).map(o=>(0,t.jsx)($,{grade:o},o[0]))]}),(0,t.jsxs)("div",{className:"flex justify-between items-center gap-6",children:[(0,t.jsx)(H,{to:`${a}/${e._id}`,className:"text-accent hover:text-accent/80 font-semibold",children:"View contestants"}),(0,t.jsxs)("div",{className:"flex justify-end gap-6",children:[(0,t.jsx)(_,{element:"button",type:"button",variant:"outline",onClick:r,className:"px-3 py-2 rounded-md font-bold min-w-[90px] border-secondary hover:border-slate-400 text-primary",children:"Close Form"}),(0,t.jsx)(_,{element:"button",type:"submit",name:"intent",value:"update_stage",className:"px-3 py-2 rounded-md font-bold min-w-[90px] text-white",children:"Submit"})]})]}),(0,t.jsx)("input",{type:"hidden",name:"social_media_type",value:e.rates.social_media.type}),(0,t.jsx)("input",{type:"hidden",name:"stageId",value:e._id})]})}function Y({stage:e}){let[a,r]=(0,V.useState)(e.enable_bonus),[o]=(0,V.useState)(e.bonus_reset_time||"00:00:00"),[d,f]=o.split(":");return(0,t.jsxs)(j,{method:"POST",className:"text-primary text-xs flex flex-col gap-4 py-4",children:[(0,t.jsxs)("fieldset",{className:"py-4 grid grid-cols-4 gap-3",children:[(0,t.jsx)("legend",{className:"font-bold text-sm text-admin-pry w-max col-span-4",children:"Stage Bonus"}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)("label",{htmlFor:"enable_bonus",className:"font-medium",children:"Enable Bonus"}),(0,t.jsx)("input",{type:"checkbox",id:"enable",name:"enable",checked:a,onChange:R=>r(R.target.checked),className:"h-5 w-5 rounded-md",value:"true"})]}),(0,t.jsx)(i,{as:"input",id:"hours",name:"hours",labelText:"Reset Time (Hours)",type:"number",min:0,max:23,defaultValue:d}),(0,t.jsx)(i,{as:"input",id:"minutes",name:"minutes",labelText:"Reset Time (Minutes)",type:"number",min:0,max:59,defaultValue:f})]}),(0,t.jsx)("div",{className:"flex justify-end gap-6",children:(0,t.jsx)(_,{element:"button",type:"submit",name:"intent",value:"toggle_stage_bonus",className:"px-3 py-2 rounded-md font-bold min-w-[90px] text-white",children:"Enable/Disable Bonus"})}),(0,t.jsx)("input",{type:"hidden",name:"stage_id",value:e._id})]})}var n=m(c(),1),Z=[{id:"expander",header:()=>null,cell:({row:e})=>e.getCanExpand()?(0,n.jsx)("button",{title:"expand row",onClick:e.getToggleExpandedHandler(),children:(0,n.jsx)(x,{src:p.arrowDownIcon,className:e.getIsExpanded()?"rotate-180":""})}):null},{accessorKey:"id",header:({column:e})=>(0,n.jsx)(v,{column:e,title:"id"}),cell:({row:e})=>(0,n.jsx)("span",{className:"uppercase",children:e.getValue("id")})},{accessorKey:"name",header:({column:e})=>(0,n.jsx)(v,{column:e,title:"contest"}),cell:({row:e})=>(0,n.jsx)("span",{className:"uppercase line-clamp-1",children:e.getValue("name")})},{accessorKey:"timeline",header:({column:e})=>(0,n.jsx)(v,{column:e,title:"timeline"}),cell:({row:e})=>(0,n.jsxs)("p",{children:[(0,n.jsx)("span",{className:"block whitespace-nowrap",children:e.original.start_date.split(".")[0].replace("T",", ")}),(0,n.jsx)("span",{className:"block whitespace-nowrap",children:e.original.end_date.split(".")[0].replace("T",", ")})]})},{accessorKey:"status",header:({column:e})=>(0,n.jsx)(v,{column:e,title:"status"}),cell:({row:e})=>{let a=e.getValue("status").split("_").join(" ");return(0,n.jsx)(K,{status:a,color:a==="registering"?"yellow":a==="ongoing"?"green":a==="completed"?"red":"gray"})}},{id:"actions",header:"actions",cell:({row:e})=>(0,n.jsx)(M,{rowData:e.original})}];function ee({data:e,pagination:a}){return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"w-full overflow-x-auto",children:(0,n.jsx)(O,{data:e,columns:Z,expandRows:!0,getRowCanExpand:()=>!0,SubComponent:B,className:"max-xs:text-xs text-sm"})}),a?(0,n.jsxs)("div",{className:"max-sm:flex-col max-xs:text-xs sm:w-4/5 mx-auto flex gap-2 justify-between items-center my-5",children:[(0,n.jsxs)("label",{className:"flex gap-2",children:["Rows per page",(0,n.jsx)("input",{type:"number",name:"rows",id:"rows",className:"w-10 pl-2 rounded-md border",defaultValue:10})]}),(0,n.jsx)(L,{})]}):null]})}export{ee as a};
