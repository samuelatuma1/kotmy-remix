{
  "version": 3,
  "sources": ["../../../app/routes/_public.contests.$tournamentId.$contestId.tsx"],
  "sourcesContent": ["// REMIX HMR BEGIN\nif (!window.$RefreshReg$ || !window.$RefreshSig$ || !window.$RefreshRuntime$) {\n  console.warn('remix:hmr: React Fast Refresh only works when the Remix compiler is running in development mode.');\n} else {\n  var prevRefreshReg = window.$RefreshReg$;\n  var prevRefreshSig = window.$RefreshSig$;\n  window.$RefreshReg$ = (type, id) => {\n    window.$RefreshRuntime$.register(type, \"\\\"app/routes/_public.contests.$tournamentId.$contestId.tsx\\\"\" + id);\n  }\n  window.$RefreshSig$ = window.$RefreshRuntime$.createSignatureFunctionForTransform;\n}\nimport * as __hmr__ from \"remix:hmr\";\nif (import.meta) {\n  import.meta.hot = __hmr__.createHotContext(\n  //@ts-expect-error\n  \"app/routes/_public.contests.$tournamentId.$contestId.tsx\");\n  import.meta.hot.lastModified = \"1760080481937.3145\";\n}\n// REMIX HMR END\n\nimport { json, redirect } from \"@remix-run/node\";\nimport { Outlet } from \"@remix-run/react\";\nimport { contestRepo } from \"~/services/contest/contest.server\";\nimport { getFingerprint, setToast } from \"~/lib/session.server\";\nimport { callTallyWebhook } from \"~/services/contestant/actions.server\";\nexport async function loader({\n  params,\n  request\n}) {\n  const {\n    tournamentId,\n    contestId\n  } = params;\n  if (!contestId) return redirect(`/contests/${tournamentId}`);\n  const url = new URL(request.url);\n  // Process transaction response\n  const tx_status = url.searchParams.get(\"status\");\n  const tx_ref = url.searchParams.get(\"tx_ref\");\n  if (tx_status && tx_ref) {\n    // call the webhook\n    await callTallyWebhook(tx_ref);\n    // create toast\n    const toast = tx_status === \"completed\" ? `success::Your payment has been received. Your vote will reflect shortly.::${Date.now()}` : `error::There seems to be an issue with your payment. Please try again later.::${Date.now()}`;\n    const {\n      headers\n    } = await setToast({\n      request,\n      toast\n    });\n    // clear other query strings and show success toast\n    url.searchParams.delete('status');\n    url.searchParams.delete('tx_ref');\n    url.searchParams.delete('transaction_id');\n    console.log(\"Redirecting to:\", `${url.pathname}?${url.searchParams.toString()}`);\n    throw redirect(`${url.pathname}?${url.searchParams.toString()}`, {\n      headers\n    });\n  }\n  const {\n    data: contest,\n    error\n  } = await contestRepo.getContestById(contestId);\n  if (error) return redirect(`/contests/${tournamentId}`);\n  if (contest.status === 'registering') return json({\n    contest,\n    stage: null,\n    baseUrl: process.env._BASE_URL\n  });\n  const stageQ = url.searchParams.get(\"stage\");\n  const stageId = (stageQ ? contest.stages.find(stage => stage.stage == +stageQ)?._id : contest.stages.find(stage => stage.active)?._id) ?? contest.stages.find(stage => stage.stage == 1)?._id;\n  const {\n    fingerprint,\n    headers\n  } = await getFingerprint({\n    request\n  });\n  const stage = stageId ? (await contestRepo.getContestantsInStage(stageId, {\n    fingerprint\n  })).data ?? null : null;\n  return json({\n    contest,\n    stage,\n    baseUrl: process.env._BASE_URL\n  }, {\n    headers\n  });\n}\nexport default function ContestLayout() {\n  return <Outlet />;\n}\n_c = ContestLayout;\nvar _c;\n$RefreshReg$(_c, \"ContestLayout\");\n\nwindow.$RefreshReg$ = prevRefreshReg;\nwindow.$RefreshSig$ = prevRefreshSig;"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAoBA,kBAA+B;AAE/B,qBAA4B;AAC5B,qBAAyC;AACzC,qBAAiC;AAgExB;AAvFT,IAAI,CAAC,OAAO,gBAAgB,CAAC,OAAO,gBAAgB,CAAC,OAAO,kBAAkB;AAC5E,UAAQ,KAAK,kGAAkG;AACjH,OAAO;AACD,mBAAiB,OAAO;AACxB,mBAAiB,OAAO;AAC5B,SAAO,eAAe,CAAC,MAAM,OAAO;AAClC,WAAO,iBAAiB,SAAS,MAAM,+DAAiE,EAAE;AAAA,EAC5G;AACA,SAAO,eAAe,OAAO,iBAAiB;AAChD;AANM;AACA;AAON,IAAI,aAAa;AACf,cAAY,MAAc;AAAA;AAAA,IAE1B;AAAA,EAA0D;AAC1D,cAAY,IAAI,eAAe;AACjC;AAsEe,SAAR,gBAAiC;AACtC,SAAO,mDAAC,YAAD;AAAA;AAAA;AAAA;AAAA,SAAQ;AACjB;AACA,KAAK;AACL,IAAI;AACJ,aAAa,IAAI,eAAe;AAEhC,OAAO,eAAe;AACtB,OAAO,eAAe;",
  "names": []
}
